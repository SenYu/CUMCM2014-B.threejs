THREE.OrbitControls=function(B,C){this.object=B;this.domElement=(C!==undefined)?C:document;this.enabled=true;this.target=new THREE.Vector3();this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var y=this;var c=0.000001;var r=new THREE.Vector2();var n=new THREE.Vector2();var z=new THREE.Vector2();var d=new THREE.Vector2();var o=new THREE.Vector2();var k=new THREE.Vector2();var F=new THREE.Vector3();var A=new THREE.Vector3();var q=new THREE.Vector2();var b=new THREE.Vector2();var x=new THREE.Vector2();var w=0;var h=0;var t=1;var j=new THREE.Vector3();var e=new THREE.Vector3();var p=new THREE.Quaternion();var f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var L=f.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var K=new THREE.Quaternion().setFromUnitVectors(B.up,new THREE.Vector3(0,1,0));var m=K.clone().inverse();var H={type:"change"};var D={type:"start"};var s={type:"end"};this.rotateLeft=function(M){if(M===undefined){M=g()}h-=M};this.rotateUp=function(M){if(M===undefined){M=g()}w-=M};this.panLeft=function(N){var M=this.object.matrix.elements;F.set(M[0],M[1],M[2]);F.multiplyScalar(-N);j.add(F)};this.panUp=function(N){var M=this.object.matrix.elements;F.set(M[4],M[5],M[6]);F.multiplyScalar(N);j.add(F)};this.pan=function(O,N){var P=y.domElement===document?y.domElement.body:y.domElement;if(y.object.fov!==undefined){var M=y.object.position;var R=M.clone().sub(y.target);var Q=R.length();Q*=Math.tan((y.object.fov/2)*Math.PI/180);y.panLeft(2*O*Q/P.clientHeight);y.panUp(2*N*Q/P.clientHeight)}else{if(y.object.top!==undefined){y.panLeft(O*(y.object.right-y.object.left)/P.clientWidth);y.panUp(N*(y.object.top-y.object.bottom)/P.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}}};this.dollyIn=function(M){if(M===undefined){M=u()}t/=M};this.dollyOut=function(M){if(M===undefined){M=u()}t*=M};this.update=function(){var N=this.object.position;A.copy(N).sub(this.target);A.applyQuaternion(K);var O=Math.atan2(A.x,A.z);var P=Math.atan2(Math.sqrt(A.x*A.x+A.z*A.z),A.y);if(this.autoRotate){this.rotateLeft(g())}O+=h;P+=w;P=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,P));P=Math.max(c,Math.min(Math.PI-c,P));var M=A.length()*t;M=Math.max(this.minDistance,Math.min(this.maxDistance,M));this.target.add(j);A.x=M*Math.sin(P)*Math.sin(O);A.y=M*Math.cos(P);A.z=M*Math.sin(P)*Math.cos(O);A.applyQuaternion(m);N.copy(this.target).add(A);this.object.lookAt(this.target);h=0;w=0;t=1;j.set(0,0,0);if(e.distanceToSquared(this.object.position)>c||8*(1-p.dot(this.object.quaternion))>c){this.dispatchEvent(H);e.copy(this.object.position);p.copy(this.object.quaternion)}};this.reset=function(){L=f.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};function g(){return 2*Math.PI/60/60*y.autoRotateSpeed}function u(){return Math.pow(0.95,y.zoomSpeed)}function G(M){if(y.enabled===false){return}M.preventDefault();if(M.button===0){if(y.noRotate===true){return}L=f.ROTATE;r.set(M.clientX,M.clientY)}else{if(M.button===1){if(y.noZoom===true){return}L=f.DOLLY;q.set(M.clientX,M.clientY)}else{if(M.button===2){if(y.noPan===true){return}L=f.PAN;d.set(M.clientX,M.clientY)}}}document.addEventListener("mousemove",a,false);document.addEventListener("mouseup",J,false);y.dispatchEvent(D)}function a(N){if(y.enabled===false){return}N.preventDefault();var M=y.domElement===document?y.domElement.body:y.domElement;if(L===f.ROTATE){if(y.noRotate===true){return}n.set(N.clientX,N.clientY);z.subVectors(n,r);y.rotateLeft(2*Math.PI*z.x/M.clientWidth*y.rotateSpeed);y.rotateUp(2*Math.PI*z.y/M.clientHeight*y.rotateSpeed);r.copy(n)}else{if(L===f.DOLLY){if(y.noZoom===true){return}b.set(N.clientX,N.clientY);x.subVectors(b,q);if(x.y>0){y.dollyIn()}else{y.dollyOut()}q.copy(b)}else{if(L===f.PAN){if(y.noPan===true){return}o.set(N.clientX,N.clientY);k.subVectors(o,d);y.pan(k.x,k.y);d.copy(o)}}}y.update()}function J(){if(y.enabled===false){return}document.removeEventListener("mousemove",a,false);document.removeEventListener("mouseup",J,false);y.dispatchEvent(s);L=f.NONE}function E(M){if(y.enabled===false||y.noZoom===true){return}M.preventDefault();M.stopPropagation();var N=0;if(M.wheelDelta!==undefined){N=M.wheelDelta}else{if(M.detail!==undefined){N=-M.detail}}if(N>0){y.dollyOut()}else{y.dollyIn()}y.update();y.dispatchEvent(D);y.dispatchEvent(s)}function i(M){if(y.enabled===false||y.noKeys===true||y.noPan===true){return}switch(M.keyCode){case y.keys.UP:y.pan(0,y.keyPanSpeed);y.update();break;case y.keys.BOTTOM:y.pan(0,-y.keyPanSpeed);y.update();break;case y.keys.LEFT:y.pan(y.keyPanSpeed,0);y.update();break;case y.keys.RIGHT:y.pan(-y.keyPanSpeed,0);y.update();break}}function I(O){if(y.enabled===false){return}switch(O.touches.length){case 1:if(y.noRotate===true){return}L=f.TOUCH_ROTATE;r.set(O.touches[0].pageX,O.touches[0].pageY);break;case 2:if(y.noZoom===true){return}L=f.TOUCH_DOLLY;var N=O.touches[0].pageX-O.touches[1].pageX;var M=O.touches[0].pageY-O.touches[1].pageY;var P=Math.sqrt(N*N+M*M);q.set(0,P);break;case 3:if(y.noPan===true){return}L=f.TOUCH_PAN;d.set(O.touches[0].pageX,O.touches[0].pageY);break;default:L=f.NONE}y.dispatchEvent(D)}function l(P){if(y.enabled===false){return}P.preventDefault();P.stopPropagation();var O=y.domElement===document?y.domElement.body:y.domElement;switch(P.touches.length){case 1:if(y.noRotate===true){return}if(L!==f.TOUCH_ROTATE){return}n.set(P.touches[0].pageX,P.touches[0].pageY);z.subVectors(n,r);y.rotateLeft(2*Math.PI*z.x/O.clientWidth*y.rotateSpeed);y.rotateUp(2*Math.PI*z.y/O.clientHeight*y.rotateSpeed);r.copy(n);y.update();break;case 2:if(y.noZoom===true){return}if(L!==f.TOUCH_DOLLY){return}var N=P.touches[0].pageX-P.touches[1].pageX;var M=P.touches[0].pageY-P.touches[1].pageY;var Q=Math.sqrt(N*N+M*M);b.set(0,Q);x.subVectors(b,q);if(x.y>0){y.dollyOut()}else{y.dollyIn()}q.copy(b);y.update();break;case 3:if(y.noPan===true){return}if(L!==f.TOUCH_PAN){return}o.set(P.touches[0].pageX,P.touches[0].pageY);k.subVectors(o,d);y.pan(k.x,k.y);d.copy(o);y.update();break;default:L=f.NONE}}function v(){if(y.enabled===false){return}y.dispatchEvent(s);L=f.NONE}this.domElement.addEventListener("contextmenu",function(M){M.preventDefault()},false);this.domElement.addEventListener("mousedown",G,false);this.domElement.addEventListener("mousewheel",E,false);this.domElement.addEventListener("DOMMouseScroll",E,false);this.domElement.addEventListener("touchstart",I,false);this.domElement.addEventListener("touchend",v,false);this.domElement.addEventListener("touchmove",l,false);window.addEventListener("keydown",i,false);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);