var container,stats;var camera,controls,scene,renderer;var cube,plane;var group=[];var PI=Math.acos(-1);init();animate();function init(){container=document.createElement("div");document.body.appendChild(container);info=document.createElement("div");info.style.position="absolute";info.style.top="10px";info.style.width="100%";info.style.textAlign="center";container.appendChild(info);camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1000);camera.position.z=150;camera.position.set(-74,71,108);controls=new THREE.OrbitControls(camera);scene=new THREE.Scene();var a=new THREE.PointLight(16777215,1.5);a.position.set(1000,1000,2000);scene.add(a);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setClearColor(15790320);renderer.setSize(window.innerWidth,window.innerHeight);renderer.domElement.id="threejsCanvas";container.appendChild(renderer.domElement);window.addEventListener("resize",onWindowResize,false);bindClick()}function bindClick(){$("#formRound2").on("click",function(){var c=Math.sqrt(25*25-23.75*23.75);var b=60,g=3,d=53-g,e=25,f=1/2;calcDetail(function(l,h){for(var k=0;k<20;k++){var j;if(k<=9){j=2*Math.sqrt(25*25-(25-k*2.5-1.25)*(25-k*2.5-1.25))}else{j=2*Math.sqrt(-(25-(k+1)*2.5+1.25)*(25-(k+1)*2.5+1.25)+25*25)}l.push({sX:j,sY:g,sZ:2.5,pX:0,pY:0,pZ:-e+2.5*k,len:b-j/2,coreX:j/2-h,extra:0})}return coreTransform(b,d,e,f,g)},c,b,d,e,f,g)});$("#formRound_1").on("click",function(){a(79.44,0.433)});$("#formRound_2-5").on("click",function(){a(81.6,0.518)});$("#formRound_3").on("click",function(){a(87.44,0.66)});function a(c,f){var b=Math.sqrt(40*40-38.75*38.75);c=c||106.88;f=f||0.357;var g=3,d=70-g,e=40;calcDetail(function(l,h){for(var k=0;k<e/2.5*2;k++){var j;if(k<e/2.5){j=2*Math.sqrt(e*e-(e-k*2.5-1.25)*(e-k*2.5-1.25))}else{j=2*Math.sqrt(-(e-(k+1)*2.5+1.25)*(e-(k+1)*2.5+1.25)+e*e)}l.push({sX:j,sY:g,sZ:2.5,pX:0,pY:0,pZ:-e+2.5*k,len:c-j/2,coreX:j/2-h,extra:0})}return coreTransform(c,d,e,f,g)},b,c,d,e,f,g)}$("#formRhombus").on("click",function(){var c=2;var b=83.76,g=3,d=73-g,e=40,f=0.566;calcDetail(function(l,h){for(var k=0;k<e/2*2;k++){var j;if(k<e/2){j=2*((k+1)*2)}else{j=2*(2*e-k*2)}l.push({sX:j,sY:g,sZ:2,pX:0,pY:0,pZ:-e+2*k,len:b-j/2,coreX:j/2-h,extra:0})}return coreTransform(b,d,e,f,g)},c,b,d,e,f,g)});$("#formRhombusRound").on("click",function(){var c=2.5;var b=58.2,g=3,d=53-g,e=25,f=0.511;calcDetail(function(l,h){for(var k=0;k<20;k++){var j;var m;if(k==0||k==19){j=2*h;m=0}else{if(k<=9){j=2*((k+1)*2.5)}else{j=2*(50-k*2.5)}}switch(parseInt(k/10)?(19-k):k){case 0:m=0;break;case 1:m=3.25;break;case 2:m=5.5;break;case 3:m=7;break;case 4:m=8;break;case 5:m=7.75;break;case 6:m=6.75;break;case 7:m=4.5;break;case 8:m=2.5;break;case 9:m=0;break}l.push({sX:j,sY:g,sZ:2.5,pX:0,pY:0,pZ:-25+2.5*k,len:b-j/2,coreX:j/2-h,extra:-m})}return coreTransform(b,50,25,f,g)},c,b,d,e,f,g)});$("#formEllipse").on("click",function(){var c=111.36,h=3,d=83-h,e=80/2,g=0.579;var b=1.5*Math.sqrt(e*e-(e-1.25)*(e-1.25));var f=1.5;calcDetail(function(m,j){for(var l=0;l<e/2.5*2;l++){var k;if(l==0||l==e/2.5*2-1){k=2*j}else{if(l<e/2.5){k=2*Math.sqrt(e*e-(e-l*2.5)*(e-l*2.5))}else{k=2*Math.sqrt(-(e-(l+1)*2.5)*(e-(l+1)*2.5)+e*e)}}k*=f;m.push({sX:k,sY:h,sZ:2.5,pX:0,pY:0,pZ:-e+2.5*l,len:c-k/2,coreX:k/2-j,extra:0})}return coreTransform(c,d,e,g,h)},b,c,d,e,g,h)})}function createGeometry(d,b,a,f,e,c,h,j){var i=new THREE.Object3D();var l=null;var k=null;h=h||8670502;if(j){l=new THREE.Mesh(new THREE.CylinderGeometry(b,b,a,32),new THREE.MeshBasicMaterial({color:h,wireframe:false}));l.rotation.set(PI/2,0,0)}else{l=new THREE.Mesh(new THREE.BoxGeometry(d,b,a),new THREE.MeshBasicMaterial({color:h,wireframe:false}));k=new THREE.Mesh(new THREE.BoxGeometry(d,b,a),new THREE.MeshBasicMaterial({color:0,wireframe:true}))}l&&l.position.set(f,e,c);k&&k.position.set(f,e,c);l&&i.add(l);k&&i.add(k);return i}function calcDetail(p,l,a,h,e,k,v){while(window.group.length){scene.remove(group[0]);group.shift()}var u=[];l=l||5;var o=p(u,l,k);var f=new THREE.Object3D();for(var m=0;m<u.length;m++){var s=u[m];f.add(createGeometry(s.sX,s.sY,s.sZ,s.pX,s.pY,s.pZ,10313266))}scene.add(f);var t=new THREE.Object3D();for(var m=0;m<u.length;m++){var s=u[m];if(m==0){var n=new THREE.Object3D();n.add(createGeometry(s.len+s.extra,s.sY,s.sZ,-a+s.len/2-s.extra/2,s.pY,s.pZ));n.add(createGeometry(0.55,0.55,2*e+2,-(a-(s.len+s.extra)*(1-k)),s.pY,-1.25,12303291,true));t.add(n)}else{t.add(createGeometry(s.len+s.extra,s.sY,s.sZ,-a+s.len/2-s.extra/2,s.pY,s.pZ))}}scene.add(t);var q=new THREE.Object3D();for(var m=0;m<u.length;m++){var s=u[m];if(m==0){var w=new THREE.Object3D();w.add(createGeometry(s.len+s.extra,s.sY,s.sZ,a-s.len/2+s.extra/2,s.pY,s.pZ));w.add(createGeometry(0.55,0.55,2*e+2,(a-(s.len+s.extra)*(1-k)),s.pY,-1.25,12303291,true));q.add(w)}else{q.add(createGeometry(s.len+s.extra,s.sY,s.sZ,a-s.len/2+s.extra/2,s.pY,s.pZ))}}scene.add(q);group.push(f);group.push(t);group.push(q);var b=0;var c=false;var j=function(B,D){if(Math.sin((b+D)/180*PI)>h/(a-l)&&D>0){c=false;return}if(b<1*Math.abs(D)&&D<0){B=true;b=-D}c=true;b+=D;var A=t.children;for(var y=0;y<A.length;y++){var r=A[y];var C=u[y];var g=o.beta(PI/2/90*b,C.coreX,l);if(false&&b>45){g+=Math.atan(C.sY/o.L1(PI/2/90*b,C.coreX,l)/2)}r.rotation.set(0,0,g);r.position.set((C.sX)*(Math.cos(g)-1)/2-C.sY/2*Math.sin(g),(C.sX)*Math.sin(g)/2-C.sY/2*(1-Math.cos(g)),0)}var A=q.children;for(var y=0;y<A.length;y++){var r=A[y];var C=u[y];var g=o.beta(PI/2/90*b,C.coreX,l);if(false&&b>45){g+=Math.atan(C.sY/o.L1(PI/2/90*b,C.coreX,l)/2)}r.rotation.set(0,0,-g);r.position.set(-(C.sX)*(Math.cos(-g)-1)/2+C.sY/2*Math.sin(g),-(C.sX)*Math.sin(-g)/2-C.sY/2*(1-Math.cos(-g)),0)}render();var x=Math.asin(h/(a-l))/PI*180;z(x*4/4);function z(E){if(Math.abs(b-E)<Math.abs(D)){for(var F=0;F<A.length;F++){var H=A[F];var G=u[F];console.log(F,E,(a-l)*k+l-G.sX/2,o.L1(PI/2/90*E,G.coreX,l),o.L1(PI/2/90*E,G.coreX,l)-((a-l)*k+l-G.sX/2),G.len)}}}if(B){c=false;return}setTimeout(function(){j(B,D)},17)};render();$("#actionAnimate").off("click").on("click",function(){if(c){return}setTimeout(function(){j(false,0.5)},17)});$("#actionReset").off("click").on("click",function(){if(c){return}setTimeout(function(){j(false,-0.5)},17)});$("#actionPlus").off("click").on("click",function(){if(c){return}setTimeout(function(){j(true,0.5)},17)});$("#actionMinus").off("click").on("click",function(){if(c){return}setTimeout(function(){j(true,-0.5)},17)});$("#actionPlusP").off("click").on("click",function(){if(c){return}setTimeout(function(){j(true,Math.asin(h/(a-l))/PI*180/8)},17)});$("#actionMinusP").off("click").on("click",function(){if(c){return}setTimeout(function(){j(true,-Math.asin(h/(a-l))/PI*180/8)},17)})}function coreTransform(a,d,e,f){var c={beta:function(k,i,h){var j=c.sinBeta(k,i,h);var l=c.cosBeta(k,i,h);if(j>=0&&l>=0){return PI-Math.asin(c.sinBeta(k,i,h))}else{if(j>=0){return Math.asin(c.sinBeta(k,i,h))}else{if(j<=0&&l>=0){return PI-Math.asin(c.sinBeta(k,i,h))}else{if(j<=0){return Math.asin(c.sinBeta(k,i,h))}}}}},sinBeta:function(k,i,h){var j=a-h;return(j)*b(k)*f/c.L1(k,i,h)},cosBeta:function(k,i,h){var j=a-h;return(i-j*f*g(k))/c.L1(k,i,h)},L1:function(k,i,h){var j=a-h;return Math.sqrt(i*i+j*j*f*f-2*i*j*f*g(k))},retX:function(k,i,h){var j=a-h;return j*g(k)-i+(j-i)*c.cosBeta(k,i,h)},retY:function(k,i,h){var j=a-h;return j*b(k)-(j-i)*c.sinBeta(k,i,h)}};return c;function b(h){return Math.sin(h)}function g(h){return Math.cos(h)}}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate);controls.update();render()}function render(){renderer.render(scene,camera)};